<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>SmartConta ¬∑ Simulador Contable</title>

  <!-- üîπ MANIFESTO EMBEBIDO PARA WIX -->
  <script type="application/manifest+json">
  {
    "name": "SmartConta",
    "short_name": "SmartConta",
    "description": "Simulador contable educativo para MYPES. Calcula ventas, compras, IGV, IR y utilidad mensual con gr√°ficos.",
    "start_url": "./",
    "display": "standalone",
    "orientation": "portrait",
    "background_color": "#ffffff",
    "theme_color": "#2563eb",
    "icons": [
      {
        "src": "https://cdn-icons-png.flaticon.com/512/4712/4712101.png",
        "sizes": "192x192",
        "type": "image/png"
      },
      {
        "src": "https://cdn-icons-png.flaticon.com/512/4712/4712101.png",
        "sizes": "512x512",
        "type": "image/png"
      }
    ]
  }
  </script>

  <meta name="theme-color" content="#2563eb">

  <style>
    :root {
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#475569;
      --accent:#2563eb;
      --accent-2:#16a34a;
      --warn:#f59e0b;
      --danger:#dc2626;
      --text:#0f172a;
      --border:#e2e8f0;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{
      width:100%;
      height:100%;
      overflow-x:hidden;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    }

    header{
      background:#ffffffcc;
      backdrop-filter:blur(8px);
      border-bottom:1px solid var(--border);
      position:sticky;
      top:0;
      z-index:10;
    }

    .wrap{
      max-width:480px;
      width:100%;
      margin:auto;
      padding:12px;
    }

    .title{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .logo{
      width:32px;height:32px;border-radius:8px;
      background:conic-gradient(from 180deg,var(--accent),var(--accent-2));
    }

    h1{font-size:20px;font-weight:800;color:var(--text)}
    h2{font-size:18px;margin-bottom:8px;color:var(--text)}
    p{font-size:13px;color:var(--muted)}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
      box-shadow:0 2px 8px rgba(15,23,42,.05);
    }

    .section-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
      flex-wrap:wrap;
      gap:6px;
    }

    .chip{
      background:#eef2ff;
      border:1px solid var(--border);
      border-radius:20px;
      padding:4px 8px;
      font-size:11px;
      color:#334155;
    }

    .row{display:flex;gap:8px;flex-wrap:wrap}
    .field{flex:1 1 140px;display:flex;flex-direction:column;gap:4px}
    label{font-size:11px;color:#334155}

    input,select,button{
      font:inherit;
      border:1px solid var(--border);
      border-radius:8px;
      padding:8px 10px;
      width:100%;
    }

    input[type="number"]:focus, select:focus{border-color:var(--accent)}
    .btn{
      background:var(--accent);
      color:#fff;
      border:0;
      font-weight:700;
      cursor:pointer;
      border-radius:8px;
      padding:8px 12px;
      font-size:14px;
    }
    .btn.secondary{background:#fff;border:1px solid var(--border);color:#0f172a}
    .btn.danger{background:var(--danger)}
    .btn:hover{opacity:.9}

    table{width:100%;border-collapse:separate;border-spacing:0 6px;font-size:13px}
    thead th{color:#334155;text-align:left;padding:0 6px}
    tbody td{background:#fff;border:1px solid var(--border);padding:6px}
    tbody td:first-child{border-radius:8px 0 0 8px}
    tbody td:last-child{border-radius:0 8px 8px 0;text-align:right}

    .totals{display:grid;gap:8px;margin-top:8px}
    .kpi{
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px;
      background:#fff;
    }
    .kpi h4{margin:0 0 4px 0;font-size:12px;color:#334155}
    .kpi .val{font-weight:900;font-size:16px;color:#111827}
    .mut{color:#64748b;font-size:11px}
    footer{text-align:center;margin:20px 0 40px;color:#64748b;font-size:11px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="wrap title">
      <div class="logo"></div>
      <div>
        <h1>SmartConta ‚Äî Simulador Contable</h1>
        <p>Calcula IGV, IR y utilidad mensual</p>
      </div>
    </div>
  </header>

  <main class="wrap" id="app">
    <section class="card">
      <div class="section-title"><h2>Video explicativo</h2><span class="chip">Demo</span></div>
      <div style="position:relative;width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden">
        <iframe src="https://www.youtube.com/embed/urhSDBpzw6Y" title="SmartConta" allowfullscreen></iframe>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Impuesto a la Renta</h2></div>
      <div class="field">
        <label for="irPct">% Impuesto a la Renta</label>
        <input id="irPct" type="number" step="0.01" value="1.5" />
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Ventas gravadas</h2><button class="btn" onclick="addRow('ventasBody')">+ Agregar</button></div>
      <div class="field"><label for="igvVentas">% IGV Ventas</label><input id="igvVentas" type="number" step="0.01" value="18" /></div>
      <table><thead><tr><th>Descripci√≥n</th><th>Total (S/)</th><th></th></tr></thead><tbody id="ventasBody"></tbody></table>
      <div class="totals">
        <div class="kpi"><h4>Base imponible</h4><div class="val" id="tVentas">S/ 0.00</div></div>
        <div class="kpi"><h4>IGV D√©bito</h4><div class="val" id="tIGVdebito">S/ 0.00</div></div>
        <div class="kpi"><h4>Total con IGV</h4><div class="val" id="tVentasIGV">S/ 0.00</div></div>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Compras gravadas</h2><button class="btn" onclick="addRow('comprasBody')">+ Agregar</button></div>
      <div class="field"><label for="igvCompras">% IGV Compras</label><input id="igvCompras" type="number" step="0.01" value="18" /></div>
      <table><thead><tr><th>Descripci√≥n</th><th>Total (S/)</th><th></th></tr></thead><tbody id="comprasBody"></tbody></table>
      <div class="totals">
        <div class="kpi"><h4>Base imponible</h4><div class="val" id="tCompras">S/ 0.00</div></div>
        <div class="kpi"><h4>IGV Cr√©dito</h4><div class="val" id="tIGVcredito">S/ 0.00</div></div>
        <div class="kpi"><h4>Total con IGV</h4><div class="val" id="tComprasIGV">S/ 0.00</div></div>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Resumen de tributos</h2></div>
      <div class="totals">
        <div class="kpi"><h4>IGV a pagar</h4><div class="val" id="igvPagar">S/ 0.00</div></div>
        <div class="kpi"><h4>IR a pagar</h4><div class="val" id="irPagar">S/ 0.00</div></div>
        <div class="kpi"><h4>Total tributos</h4><div class="val" id="totalTributos">S/ 0.00</div></div>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Otros gastos</h2><button class="btn" onclick="addGasto()">+ Agregar</button></div>
      <table><thead><tr><th>Descripci√≥n</th><th>Monto (S/)</th><th></th></tr></thead><tbody id="gastosBody"></tbody></table>
      <div class="totals">
        <div class="kpi"><h4>Total gastos</h4><div class="val" id="tGastos">S/ 0.00</div></div>
        <div class="kpi"><h4>Utilidad mensual</h4><div class="val" id="utilidadMes">S/ 0.00</div></div>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><h2>Registro anual</h2></div>
      <canvas id="chart" height="160"></canvas>
    </section>
  </main>

  <footer>¬© SmartConta ‚Äî Demo educativa.</footer>

  <template id="rowTemplate">
    <tr>
      <td><input type="text" placeholder="Descripci√≥n" /></td>
      <td><input type="number" step="0.01" placeholder="0.00" /></td>
      <td><button class="btn secondary" onclick="dupRow(this)">‚Üª</button><button class="btn danger" onclick="delRow(this)">‚úï</button></td>
    </tr>
  </template>

  <template id="gastoTemplate">
    <tr>
      <td><input type="text" placeholder="Descripci√≥n" /></td>
      <td><input type="number" step="0.01" placeholder="0.00" /></td>
      <td><button class="btn secondary" onclick="dupGasto(this)">‚Üª</button><button class="btn danger" onclick="delGasto(this)">‚úï</button></td>
    </tr>
  </template>

  <script>
    const PEN=new Intl.NumberFormat('es-PE',{style:'currency',currency:'PEN'});
    const ventasBody=document.getElementById('ventasBody'),comprasBody=document.getElementById('comprasBody'),gastosBody=document.getElementById('gastosBody'),rowTemplate=document.getElementById('rowTemplate'),gastoTemplate=document.getElementById('gastoTemplate');
    const igvVentasInput=document.getElementById('igvVentas'),igvComprasInput=document.getElementById('igvCompras'),irPctInput=document.getElementById('irPct');
    const tVentasEl=document.getElementById('tVentas'),tIGVdebitoEl=document.getElementById('tIGVdebito'),tVentasIGVEl=document.getElementById('tVentasIGV'),tComprasEl=document.getElementById('tCompras'),tIGVcreditoEl=document.getElementById('tIGVcredito'),tComprasIGVEl=document.getElementById('tComprasIGV'),igvPagarEl=document.getElementById('igvPagar'),irPagarEl=document.getElementById('irPagar'),totalTributosEl=document.getElementById('totalTributos'),tGastosEl=document.getElementById('tGastos'),utilidadMesEl=document.getElementById('utilidadMes');
    let chart;

    function addRow(id){const t=document.getElementById(id);const n=rowTemplate.content.cloneNode(true);t.appendChild(n);hookInputs();compute();}
    function delRow(b){b.closest('tr').remove();compute();}
    function dupRow(b){const tr=b.closest('tr');const c=tr.cloneNode(true);tr.parentElement.insertBefore(c,tr.nextSibling);hookInputs();compute();}
    function addGasto(){const n=gastoTemplate.content.cloneNode(true);gastosBody.appendChild(n);hookInputs();compute();}
    function delGasto(b){b.closest('tr').remove();compute();}
    function dupGasto(b){const tr=b.closest('tr');const c=tr.cloneNode(true);tr.parentElement.insertBefore(c,tr.nextSibling);hookInputs();compute();}
    function sumFromTbody(t){let s=0;[...t.querySelectorAll('tr')].forEach(tr=>{const v=parseFloat(tr.querySelector('td:nth-child(2) input').value||0);s+=isNaN(v)?0:v;});return s;}

    function compute(){
      const tasaV=(parseFloat(igvVentasInput.value)||0)/100,tasaC=(parseFloat(igvComprasInput.value)||0)/100,totalV=sumFromTbody(ventasBody),totalC=sumFromTbody(comprasBody);
      const baseV=totalV/(1+tasaV),igvD=totalV-baseV,baseC=totalC/(1+tasaC),igvCr=totalC-baseC,igvP=Math.max(0,igvD-igvCr);
      const renta=parseFloat(irPctInput.value)||0,irP=baseV*(renta/100),gastos=sumFromTbody(gastosBody),utilidad=totalV-totalC-igvP-irP-gastos;
      tVentasEl.textContent=PEN.format(baseV);tIGVdebitoEl.textContent=PEN.format(igvD);tVentasIGVEl.textContent=PEN.format(totalV);tComprasEl.textContent=PEN.format(baseC);tIGVcreditoEl.textContent=PEN.format(igvCr);tComprasIGVEl.textContent=PEN.format(totalC);
      igvPagarEl.textContent=PEN.format(igvP);irPagarEl.textContent=PEN.format(irP);totalTributosEl.textContent=PEN.format(igvP+irP);tGastosEl.textContent=PEN.format(gastos);utilidadMesEl.textContent=PEN.format(utilidad);drawChart(utilidad);
    }

    function drawChart(u){
      const ctx=document.getElementById('chart').getContext('2d');
      if(chart)chart.destroy();
      chart=new Chart(ctx,{type:'bar',data:{labels:['Utilidad'],datasets:[{label:'Resultado mensual',data:[u],backgroundColor:'#2563eb'}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});
    }

    function hookInputs(){document.querySelectorAll('input').forEach(i=>{i.oninput=compute;});}
    function init(){addRow('ventasBody');addRow('comprasBody');addGasto();hookInputs();compute();}
    init();

    // üîπ SERVICE WORKER INLINE PARA WIX
    if ('serviceWorker' in navigator) {
      const code = `
        self.addEventListener("install", e => {
          e.waitUntil(caches.open("smartconta").then(c => c.addAll(["./"])));
        });
        self.addEventListener("fetch", e => {
          e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
        });
      `;
      const blob = new Blob([code], { type: "text/javascript" });
      const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl)
        .then(() => console.log("‚úÖ Service Worker activo en Wix"))
        .catch(err => console.warn("‚ö†Ô∏è Error en SW:", err));
    }
  </script>
</body>
</html>
